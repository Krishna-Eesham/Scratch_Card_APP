<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scratch Card</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</head>
<body>

  <h1>ðŸŽ‰ Your Scratch Card ðŸŽ‰</h1>

  <div id="scratch-card">
    <div id="scratch-content">Loading Prize...</div>
    <canvas id="scratch-canvas"></canvas>
  </div>

  <script>
  const urlParams = new URLSearchParams(window.location.search);
  const userId = urlParams.get('id');
  const prize = urlParams.get('prize');

  const scratchContent = document.getElementById('scratch-content');
  scratchContent.innerText = prize || 'No Prize';

  const canvas = document.getElementById('scratch-canvas');
  const ctx = canvas.getContext('2d');

  let isDrawing = false;
  let isScratched = false;

  const scratchSound = new Audio('scratch.mp3');
  scratchSound.loop = true;

  function startSound() {
    scratchSound.play().catch(() => {});
  }

  function stopSound() {
    scratchSound.pause();
    scratchSound.currentTime = 0;
  }

  function resizeCanvas() {
  const rect = scratchContent.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;

  canvas.style.width = rect.width + 'px';
  canvas.style.height = rect.height + 'px';

  ctx.fillStyle = 'gray';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.globalCompositeOperation = 'destination-out';
}

  
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function scratch(x, y) {
    if (isScratched) return;
    ctx.beginPath();
    ctx.arc(x, y, 20, 0, Math.PI * 2);
    ctx.fill();
    checkScratchPercentage();
  }

  function checkScratchPercentage() {
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    let clearedPixels = 0;
    for (let i = 0; i < imageData.data.length; i += 4) {
      if (imageData.data[i + 3] === 0) {
        clearedPixels++;
      }
    }
    const totalPixels = canvas.width * canvas.height;
    const clearedPercent = (clearedPixels / totalPixels) * 100;
    if (clearedPercent > 60) {
      revealPrize();
    }
  }

  function revealPrize() {
    isScratched = true;
    canvas.style.pointerEvents = 'none';
    fireConfetti();
    alert('ðŸŽ‰ Congratulations! You revealed your prize!');
    stopSound();
  }

  function fireConfetti() {
    confetti({
      particleCount: 150,
      spread: 70,
      origin: { y: 0.6 }
    });
  }

  // Mouse
  canvas.addEventListener('mousedown', (e) => {
    isDrawing = true;
    startSound();
    scratch(e.offsetX, e.offsetY);
  });
  canvas.addEventListener('mousemove', (e) => {
    if (isDrawing) scratch(e.offsetX, e.offsetY);
  });
  canvas.addEventListener('mouseup', () => {
    isDrawing = false;
    stopSound();
  });

  // Touch
  canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    isDrawing = true;
    startSound();
    const rect = canvas.getBoundingClientRect();
    const x = e.touches[0].clientX - rect.left;
    const y = e.touches[0].clientY - rect.top;
    scratch(x, y);
  });
  canvas.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if (!isDrawing) return;
    const rect = canvas.getBoundingClientRect();
    const x = e.touches[0].clientX - rect.left;
    const y = e.touches[0].clientY - rect.top;
    scratch(x, y);
  });
  canvas.addEventListener('touchend', () => {
    isDrawing = false;
    stopSound();
  });
</script>
